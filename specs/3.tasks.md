# Development Task Checklist

This checklist is generated from the design document (`specs/2.design.md`) and reflects the tasks already completed in the existing source code.

### Project Setup & Build

- [x] Create `Cargo.toml` with package information and metadata.
- [x] Add all required dependencies (`anyhow`, `flood-tide`, `runnel`, `memx-cdy`).
- [x] Configure the project as a library and a binary.
- [x] Set up `build.rs` for build-time information generation.

### Configuration (`conf` module)

- [x] Implement the `conf` module for argument parsing.
- [x] Define the `CmdOptConf` struct to store configuration.
- [x] Use `flood-tide` to parse GNU-style arguments in `parse.rs`.
- [x] Define CLI options: `--head`, `--tail`, `--inverse`, `--help`, `--version`.
- [x] Implement validation logic to require `--head` or `--tail`.
- [x] Implement validation for argument values (e.g., ensuring `<num>` is a number).
- [x] Use included text files (`cmd.help.rs.txt`, `cmd.match.rs.txt`) to generate parser definitions.

### Core Logic (`run` module)

- [x] Implement the `run` module for the primary application logic.
- [x] Create a main `run()` function that dispatches to the correct implementation based on the `--inverse` flag.
- [x] Implement the `run_normal()` function to handle standard head and tail extraction.
- [x] Use a vector as a circular buffer for efficient tail processing in `run_normal()`.
- [x] Implement the `run_inverse()` function to handle inverted selection.
- [x] Read from standard input and write results to standard output.

### Application Entrypoint (`main.rs` and `lib.rs`)

- [x] Create the `main.rs` binary entry point.
- [x] Get command-line arguments from the environment.
- [x] Create the `lib.rs` library facade.
- [x] Implement the public `execute()` function in `lib.rs`.
- [x] Orchestrate the calls to `conf::parse_cmdopts()` and `run::run()` from `lib.rs`.
- [x] Handle `--help` and `--version` flags in `lib.rs` to exit early.
- [x] Implement top-level error handling in `main.rs` and set the process exit code.

### Utilities (`util` module)

- [x] Implement the `util` module for shared code.
- [x] Create the `err.rs` submodule.
- [x] Define and implement the `BrokenPipeError` trait to handle `SIGPIPE` gracefully.
- [x] Integrate the broken pipe check into the `run` module.
- [x] Implement parsing for special `-X` options in `opt_uc_x_param.rs`.
