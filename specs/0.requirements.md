# Application Requirements: aki-unbody

## 1. Overview

`aki-unbody` is a command-line utility designed to process text from standard input and output specific portions of it, similar to the standard `head` and `tail` commands. Its primary function is to extract the beginning (head), the end (tail), or the central body of a text stream, with the option to invert the selection.

## 2. Functional Requirements

The application must be able to:

- Read text data line-by-line from standard input.
- Write the processed text data to standard output.
- Handle errors and write appropriate messages to standard error.

### 2.1. Core Operations

The application supports three main operations that can be used individually or combined:

- **Head Extraction:** Output the first `N` lines of the input stream.
- **Tail Extraction:** Output the last `N` lines of the input stream.
- **Inverse Extraction:** Output the lines that are *not* part of the specified head or tail. This effectively extracts the "body" of the text stream.

## 3. Command-Line Interface (CLI) Specification

The application must be invokable with the following command-line arguments:

| Short | Long      | Has Value | Description                                          |
|-------|-----------|-----------|------------------------------------------------------|
| `-h`  | `--head`    | Yes (`<num>`) | Specifies the number of lines to output from the start. |
| `-t`  | `--tail`    | Yes (`<num>`) | Specifies the number of lines to output from the end.    |
| `-i`  | `--inverse` | No        | Inverts the selection, printing the body instead.    |
| `-H`  | `--help`    | No        | Displays a help message and exits.                   |
| `-V`  | `--version` | No        | Displays version information and exits.              |
| `-X`  |           | Yes (`<opt>`) | Reserved for special, non-core options.              |

**Constraint:** The application must be started with at least a `--head` or `--tail` option unless requesting help or version information.

## 4. Non-Functional Requirements

### 4.1. Dependencies

The application relies on the following primary external Rust crates:

- **`anyhow`**: For flexible error handling.
- **`flood-tide`**: For command-line argument parsing.
- **`runnel`**: For managing standard input/output/error streams.
- **`memx-cdy`**: For memory optimization.

### 4.2. Performance

The application should process input streams efficiently, especially when dealing with large files. Memory usage for the tail buffer should be proportional to the number of lines requested.

### 4.3. Error Handling

- If invalid arguments are provided, the application shall print an error message to standard error and exit with a non-zero status code.
- In case of I/O errors (e.g., a broken pipe), the application should exit gracefully without panicking.
